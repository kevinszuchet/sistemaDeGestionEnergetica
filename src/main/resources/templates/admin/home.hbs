{{#partial "headTags"}}
	<!-- Datepicker -->
	<link id="bsdp-css" href="https://uxsolutions.github.io/bootstrap-datepicker/bootstrap-datepicker/css/bootstrap-datepicker3.min.css" rel="stylesheet">
	<script src="https://uxsolutions.github.io/bootstrap-datepicker/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
	<script src="https://uxsolutions.github.io/bootstrap-datepicker/bootstrap-datepicker/js/locales/bootstrap-datepicker.es.min.js" charset="UTF-8"></script>

	<!-- DataTables -->
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.css"/>
	<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.js"></script>
{{/partial}}

{{#partial "contenido"}}
	<div class="pb-2 mt-4 mb-2">
		<h2>Hogares</h2>
	</div>
	<div class="text-right">				
		<a href="/dispositivos/nuevo" class="btn btn-primary btn-outline-secondary">Agregar dispositivo gen&eacute;rico</a>
	</div>
	<div class="row">
        <div class='mt-3'>
        	
			<form class="mt-3" action="javascript:obtenerConsumos();" role="form">			
		  		<div class="form-row align-items-center justify-content-center">
             		<div class="col-auto">
	             		<div class="input-daterange input-group" id="datepicker">
	           				<div class="col-auto">
					    		<input type="text" class="input-sm form-control datepicker" name="desde" placeholder="Desde" />
							</div>
					    	<div class="col-auto">
					    		<input type="text" class="input-sm form-control datepicker" name="hasta" placeholder="Hasta"/>
					    	</div>
						</div>
					</div>
	     			<div class="col-auto">
		       			<button type="submit" class="btn btn-info mb-2"><i class="fa fa-filter"></i> Filtrar</button>
		       			<button type="button" onclick="limpiarFiltros();" class="btn btn-danger mb-2"><i class="fa fa-trash"></i> Limpiar</button>
		     		</div>
		  		</div>
			</form>
       
        </div>
    </div>
    
    <div id="clientes" class="list-group list-group-flush mt-5">
    	
     		
    </div>
  
{{/partial}}


{{#partial "scripts"}}
  <script type="text/javascript">
	$(document).ready(function() {
	    $('#datepicker').datepicker({
			clearBtn: true,
			language: "es",
			orientation: "bottom auto"
		});

		obtenerConsumos();
	});

	function obtenerConsumos() {
	
		const desde = $('[name="desde"]').val(), hasta = $('[name="hasta"]').val();

		$.get("/admin/consumos",
			{ desde: desde, hasta: hasta },
			function(data, status) {
				const rowsCliente = data.reduce(function(row, cliente) {
					return row + ''+
					    
						 '<li class="list-group-item">'+
						   ' <div class="d-flex w-100 justify-content-between">'+
						     ' <h5 class="mb-1">'+  cliente[1] +'</h5>'+
						      '<small class="text-muted">Consumo '+cliente[3]+'</small>' +
						   ' </div>'+
					  	   '<p class="mb-1">Categor&iacute;a: '+cliente[0]+'</p>'+
					      '<small class="text-muted">Cliente desde '+cliente[2]+'</small>'+
						 '</li>'
		      			;
				}, '');

					

				$('#clientes').html(rowsCliente);
				
	    	}, 
	    	"json" // dataType expected
	    );
	}
	
	function limpiarFiltros() {
		$(".datepicker").datepicker("setDate", "");
		obtenerConsumos();
	}	
  </script>
{{/partial}}

{{>layout.hbs}}